# SQL Server Maintenance Plan Documentation
This document outlines how to create and configure a robust SQL Server Maintenance Plan to ensure the health, performance, and reliability of your databases. The plan includes nightly integrity checks, index maintenance, backups, and cleanup tasks.

üõ† Prerequisites
Enable SQL Server Agent XPs
Before creating a Maintenance Plan, enable the Agent XPs option:

sql
Copy
Edit
sp_configure 'Agent XPs', 1;
RECONFIGURE;
Ensure SQL Server Agent Is Running
If you encounter errors, verify that SQL Server Agent is running:

In SQL Server Management Studio (SSMS), expand the Object Explorer.

Right-click SQL Server Agent and select Start.

üì¶ Create Maintenance Plan
In SSMS, navigate to Management > Maintenance Plans.

Right-click Maintenance Plans and select New Maintenance Plan.

Give your plan a descriptive name (e.g., Master Maintenance Plan).

üåô Subplan: Every Night
1. Check Database Integrity Task
Verifies logical and physical consistency of databases.

Settings:

Right-click the task > Edit.

Set Connection to your server.

Select All Databases.

Check Ignore databases where the state is not online.

2. Rebuild Index Task
Improve performance by defragmenting indexes (target: current year projects).

Settings:

Choose Change free space per page to 20%.

3. Update Statistics Task
Updates table and column statistics for the Query Optimizer.

Best scheduled at night to avoid impact during business hours.

4. Backup Database Task
Takes Full Backup of all databases.

Settings:

Backup type: Full.

Databases: All Databases.

Backup to Disk, specify directory.

Enable: Create a sub-directory for each database.

On the Options tab:

Enable options as needed:

Compress Backup

Perform Checksum

Continue on Error

Backup Encryption (optional)

Block Size and Max Transfer Size: usually left to defaults.

5. History Cleanup Task
Removes outdated job history and logs.

Enable the following:

Backup and Restore History

SQL Server Agent Job History

Maintenance Plan History

Specify how long to retain history (e.g., 14 days).

6. Maintenance Cleanup Task
Deletes old backup files to save disk space.

Settings:

Set workflow to run on success of the backup task.

File type: Backup files.

Set the path, enable Include first-level subfolders.

File extension: .bak.

Define the retention period (e.g., delete older than 7 days).

‚ö† Important: Connect each task to the previous one using arrows, otherwise they will run in parallel.

üïê Subplan: Every Half Hour (Transaction Log Backup)
Add Backup Database Task and select Transaction Log as backup type.

Choose All Databases (Simple recovery model DBs are auto-excluded).

Set the destination folder.

Configure Options similar to Full Backup.

Add Maintenance Cleanup Task to delete old .trn log files.

Set the same retention duration as Full Backups.

üîÅ Subplan: Every Hour (Differential Backup)
Add Backup Database Task, set type to Differential.

Select All Databases.

Define the destination folder and file suffix (e.g., .diff).

Set Options similar to the nightly backup task.

Add Maintenance Cleanup Task to remove old differential backups.

Use the same retention duration as other backup types.

‚úÖ Final Output
Once saved, the plan will create SQL Server Agent Jobs with names like:

Master Plan Every Night

Master Plan Every Hour

Master Plan Every Half

‚úÖ Tip: To modify jobs, use the Maintenance Plan Designer instead of editing the jobs directly.

üìù Reporting & Logging
The Reporting and Logging icon in the Maintenance Plan allows SQL Server to generate a text log for each run.

Considerations:
These logs may accumulate and use up disk space.

You can:

Uncheck Generate a text file report, OR

Use Maintenance Cleanup Task to delete old .txt reports by selecting Maintenance Plan text reports.
